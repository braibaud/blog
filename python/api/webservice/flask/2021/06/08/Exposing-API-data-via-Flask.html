<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Exposing API data via Flask | The Blue Notebooks</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Exposing API data via Flask" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An example of API data transformation and serving." />
<meta property="og:description" content="An example of API data transformation and serving." />
<link rel="canonical" href="https://braibaud.github.io/blog/python/api/webservice/flask/2021/06/08/Exposing-API-data-via-Flask.html" />
<meta property="og:url" content="https://braibaud.github.io/blog/python/api/webservice/flask/2021/06/08/Exposing-API-data-via-Flask.html" />
<meta property="og:site_name" content="The Blue Notebooks" />
<meta property="og:image" content="https://braibaud.github.io/blog/images/copied_from_nb/images/2021-06-08-exposing-api-data-via-flask-main.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-08T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://braibaud.github.io/blog/python/api/webservice/flask/2021/06/08/Exposing-API-data-via-Flask.html","@type":"BlogPosting","headline":"Exposing API data via Flask","dateModified":"2021-06-08T00:00:00-05:00","datePublished":"2021-06-08T00:00:00-05:00","image":"https://braibaud.github.io/blog/images/copied_from_nb/images/2021-06-08-exposing-api-data-via-flask-main.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://braibaud.github.io/blog/python/api/webservice/flask/2021/06/08/Exposing-API-data-via-Flask.html"},"description":"An example of API data transformation and serving.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://braibaud.github.io/blog/feed.xml" title="The Blue Notebooks" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">The Blue Notebooks</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Exposing API data via Flask</h1><p class="page-description">An example of API data transformation and serving.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-08T00:00:00-05:00" itemprop="datePublished">
        Jun 8, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      10 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#api">api</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#webservice">webservice</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#flask">flask</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/braibaud/blog/tree/master/_notebooks/2021-06-08-Exposing API data via Flask.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/braibaud/blog/master?filepath=_notebooks%2F2021-06-08-Exposing+API+data+via+Flask.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/braibaud/blog/blob/master/_notebooks/2021-06-08-Exposing API data via Flask.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#About">About </a>
<ul>
<li class="toc-entry toc-h2"><a href="#The-required-libraries">The required libraries </a></li>
<li class="toc-entry toc-h2"><a href="#Get-data-from-Airbnb-API">Get data from Airbnb API </a></li>
<li class="toc-entry toc-h2"><a href="#Publishing-data-as-a-webservice">Publishing data as a webservice </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-06-08-Exposing API data via Flask.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="About">
<a class="anchor" href="#About" aria-hidden="true"><span class="octicon octicon-link"></span></a>About<a class="anchor-link" href="#About"> </a>
</h1>
<p>We are going to pull data from a webservice, transform it and serve it back via a webservice.</p>
<p><img src="/blog/images/copied_from_nb/./images/2021-06-08-exposing-api-data-via-flask-main.jpg" alt="Photo by Andrea Davis"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-required-libraries">
<a class="anchor" href="#The-required-libraries" aria-hidden="true"><span class="octicon octicon-link"></span></a>The required libraries<a class="anchor-link" href="#The-required-libraries"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">airbnb</span> <span class="k">as</span> <span class="nn">ab</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">locale</span> <span class="k">as</span> <span class="nn">lo</span>
<span class="kn">import</span> <span class="nn">argparse</span> <span class="k">as</span> <span class="nn">ap</span>
<span class="kn">import</span> <span class="nn">traceback</span> <span class="k">as</span> <span class="nn">tb</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">functools</span> <span class="k">as</span> <span class="nn">ft</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span> <span class="k">as</span> <span class="n">dtp</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we'll expose webservice endpoints, we should import the following <code>flask</code> elements.</p>
<blockquote>
<p>Those elements can be installed using <code>pip install flask flask-restful flask-wtf flask-cors</code></p>
</blockquote>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">flask</span> <span class="k">as</span> <span class="nn">fl</span>
<span class="kn">import</span> <span class="nn">flask_restful</span> <span class="k">as</span> <span class="nn">flr</span>
<span class="kn">import</span> <span class="nn">flask_restful.reqparse</span> <span class="k">as</span> <span class="nn">flr_r</span>
<span class="kn">import</span> <span class="nn">flask_cors</span> <span class="k">as</span> <span class="nn">flc</span>
<span class="kn">import</span> <span class="nn">flask_wtf.csrf</span> <span class="k">as</span> <span class="nn">flwc</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-data-from-Airbnb-API">
<a class="anchor" href="#Get-data-from-Airbnb-API" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get data from Airbnb API<a class="anchor-link" href="#Get-data-from-Airbnb-API"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Let's pull <code>reviews</code> and <code>rating</code> information from <strong>Airbnb</strong> for a given <code>listing_id</code> (a property available to rent on Airbnb).</p>
</blockquote>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_reviews</span><span class="p">(</span>
    <span class="n">listing_id</span><span class="p">,</span> 
    <span class="n">locale</span><span class="o">=</span><span class="s1">'fr'</span><span class="p">,</span> 
    <span class="n">page_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
    <span class="n">keep_n_reviews</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
    <span class="n">min_rating</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">most_recent_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">api</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Api</span><span class="p">(</span><span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'x-airbnb-locale'</span><span class="p">]</span> <span class="o">=</span> <span class="n">locale</span>
    <span class="n">api</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'accept-language'</span><span class="p">]</span> <span class="o">=</span> <span class="n">locale</span>
    <span class="n">lo</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">lo</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
    
    <span class="n">reviews</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">reviews_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">has_more_reviews</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">reviews_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">while</span> <span class="n">has_more_reviews</span><span class="p">:</span>
        <span class="n">page_reviews</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_reviews</span><span class="p">(</span>
            <span class="n">listing_id</span><span class="o">=</span><span class="n">listing_id</span><span class="p">,</span> 
            <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> 
            <span class="n">limit</span><span class="o">=</span><span class="n">page_size</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">page_reviews</span><span class="p">[</span><span class="s1">'reviews'</span><span class="p">]:</span>
            <span class="n">review</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">review</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">])</span>
            <span class="n">reviews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>

        <span class="n">reviews_count</span> <span class="o">=</span> <span class="n">page_reviews</span><span class="p">[</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'reviews_count'</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_reviews</span><span class="p">[</span><span class="s1">'reviews'</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">page_size</span><span class="p">:</span>
            <span class="n">has_more_reviews</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="n">page_size</span>

    <span class="k">if</span> <span class="n">min_rating</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reviews</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_rating</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">compare_reviews</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">most_recent_first</span><span class="o">=</span><span class="n">most_recent_first</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">most_recent_first</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">left</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">left</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]</span> <span class="o">==</span> <span class="n">right</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">left</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">[</span><span class="s1">'created_at__dt'</span><span class="p">]:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            
    <span class="n">reviews</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">reviews</span><span class="p">,</span> 
        <span class="n">key</span><span class="o">=</span><span class="n">ft</span><span class="o">.</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">compare_reviews</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">keep_n_reviews</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">[:</span><span class="n">keep_n_reviews</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">reviews</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_listing_details</span><span class="p">(</span>
    <span class="n">listing_id</span><span class="p">,</span> 
    <span class="n">locale</span><span class="o">=</span><span class="s1">'fr'</span><span class="p">):</span>
    
    <span class="n">api</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Api</span><span class="p">(</span><span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'x-airbnb-locale'</span><span class="p">]</span> <span class="o">=</span> <span class="n">locale</span>
    <span class="n">api</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'accept-language'</span><span class="p">]</span> <span class="o">=</span> <span class="n">locale</span>
    <span class="n">lo</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">lo</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
    
    <span class="n">url_base</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">API_URL</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s1">'</span><span class="si">{0}</span><span class="s1">/pdp_listing_details/</span><span class="si">{1}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">url_base</span><span class="p">,</span>
            <span class="n">listing_id</span><span class="p">),</span> 
        <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s1">'_format'</span><span class="p">:</span> <span class="s1">'for_rooms_show'</span><span class="p">})</span>
    
    <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_ratings</span><span class="p">(</span>
    <span class="n">listing_id</span><span class="p">,</span> 
    <span class="n">locale</span><span class="o">=</span><span class="s1">'fr'</span><span class="p">,</span>
    <span class="n">keep_n_reviews</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
    <span class="n">min_rating</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">most_recent_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">listing_details</span> <span class="o">=</span> <span class="n">get_listing_details</span><span class="p">(</span>
        <span class="n">listing_id</span><span class="o">=</span><span class="n">listing_id</span><span class="p">,</span> 
        <span class="n">locale</span><span class="o">=</span><span class="n">locale</span><span class="p">)</span>
    
    <span class="n">reviews</span> <span class="o">=</span> <span class="n">get_reviews</span><span class="p">(</span>
        <span class="n">listing_id</span><span class="o">=</span><span class="n">listing_id</span><span class="p">,</span> 
        <span class="n">locale</span><span class="o">=</span><span class="n">locale</span><span class="p">,</span> 
        <span class="n">keep_n_reviews</span><span class="o">=</span><span class="n">keep_n_reviews</span><span class="p">,</span> 
        <span class="n">min_rating</span><span class="o">=</span><span class="n">min_rating</span><span class="p">,</span>
        <span class="n">most_recent_first</span><span class="o">=</span><span class="n">most_recent_first</span><span class="p">)</span>
    
    <span class="n">overall_rating_text</span> <span class="o">=</span> <span class="n">listing_details</span><span class="p">[</span><span class="s1">'pdp_listing_detail'</span><span class="p">][</span><span class="s1">'reviews_module'</span><span class="p">][</span><span class="s1">'localized_overall_rating'</span><span class="p">]</span>
    <span class="n">overall_rating_terms</span> <span class="o">=</span> <span class="n">listing_details</span><span class="p">[</span><span class="s1">'pdp_listing_detail'</span><span class="p">][</span><span class="s1">'reviews_module'</span><span class="p">][</span><span class="s1">'appreciation_tags'</span><span class="p">]</span>
    
    <span class="n">review_details</span> <span class="o">=</span> <span class="n">listing_details</span><span class="p">[</span><span class="s1">'pdp_listing_detail'</span><span class="p">][</span><span class="s1">'review_details_interface'</span><span class="p">]</span>

    <span class="n">overall_rating</span> <span class="o">=</span> <span class="n">lo</span><span class="o">.</span><span class="n">atof</span><span class="p">(</span><span class="n">overall_rating_text</span><span class="p">)</span>
    <span class="n">review_count</span> <span class="o">=</span> <span class="n">review_details</span><span class="p">[</span><span class="s1">'review_count'</span><span class="p">]</span>
    <span class="n">review_summary</span> <span class="o">=</span> <span class="n">review_details</span><span class="p">[</span><span class="s1">'review_summary'</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">summary</span> <span class="ow">in</span> <span class="n">review_summary</span><span class="p">:</span>
        <span class="n">summary</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lo</span><span class="o">.</span><span class="n">atof</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">'localized_rating'</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">'overall_rating'</span><span class="p">:</span> <span class="n">overall_rating</span><span class="p">,</span> 
        <span class="s1">'review_count'</span><span class="p">:</span> <span class="n">review_count</span><span class="p">,</span> 
        <span class="s1">'categories'</span><span class="p">:</span> <span class="n">review_summary</span><span class="p">,</span>
        <span class="s1">'rating_terms'</span><span class="p">:</span> <span class="n">overall_rating_terms</span><span class="p">,</span>
        <span class="s1">'reviews'</span><span class="p">:</span> <span class="n">reviews</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can get the individual <code>reviews</code> by calling the <code>get_reviews</code> function defiend above:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">listing_id</span> <span class="o">=</span> <span class="mi">36902451</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_ratings</span><span class="p">(</span><span class="n">listing_id</span><span class="o">=</span><span class="n">listing_id</span><span class="p">,</span> <span class="n">keep_n_reviews</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'accept': 'application/json', 'accept-encoding': 'br, gzip, deflate', 'content-type': 'application/json', 'x-airbnb-api-key': '915pw2pnf4h1aiguhph5gc5b2', 'user-agent': 'Airbnb/17.13 iPhone/10.3.1 Type/Phone', 'x-airbnb-screensize': 'w=375.00;h=812.00', 'x-airbnb-carrier-name': 'T-Mobile', 'x-airbnb-network-type': 'wifi', 'x-airbnb-currency': 'USD', 'x-airbnb-locale': 'fr', 'x-airbnb-carrier-country': 'us', 'accept-language': 'fr', 'airbnb-device-id': '9a9092886fafc1b44f13c1a26cbb9ae0b1207e4c', 'x-airbnb-advertising-id': '09A2B1E9-278F-4E1C-9159-5659F82D890B'}
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'overall_rating': 4.97,
 'review_count': 31,
 'categories': [{'category': 'accuracy',
   'value': 10,
   'label': 'PrÃ©cision',
   'localized_rating': '5,0',
   'percentage': 1.0,
   'rating': 5.0},
  {'category': 'communication',
   'value': 10,
   'label': 'Communication',
   'localized_rating': '5,0',
   'percentage': 1.0,
   'rating': 5.0},
  {'category': 'cleanliness',
   'value': 10,
   'label': 'PropretÃ©',
   'localized_rating': '5,0',
   'percentage': 0.994,
   'rating': 5.0},
  {'category': 'location',
   'value': 10,
   'label': 'Emplacement',
   'localized_rating': '5,0',
   'percentage': 1.0,
   'rating': 5.0},
  {'category': 'checkin',
   'value': 10,
   'label': 'ArrivÃ©e',
   'localized_rating': '5,0',
   'percentage': 1.0,
   'rating': 5.0},
  {'category': 'value',
   'value': 10,
   'label': 'QualitÃ©-prix',
   'localized_rating': '5,0',
   'percentage': 0.994,
   'rating': 5.0}],
 'rating_terms': [{'localized_text': 'PropretÃ© impeccable',
   'localized_count_string': '15',
   'icon': 'IconIndicatorTub'},
  {'localized_text': 'HospitalitÃ© unique',
   'localized_count_string': '13',
   'icon': 'IconIndicatorHeart'},
  {'localized_text': 'RÃ©activitÃ©',
   'localized_count_string': '11',
   'icon': 'IconIndicatorChatBubble'},
  {'localized_text': 'DÃ©co et design',
   'localized_count_string': '7',
   'icon': 'IconIndicatorInterior'},
  {'localized_text': 'Ã‰quipements exceptionnels',
   'localized_count_string': '6',
   'icon': 'IconIndicatorCup'}],
 'reviews': [{'author': {'first_name': 'Camille',
    'has_profile_pic': True,
    'id': 8054257,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/da31231b-666d-4167-a02e-9e619c0dc22c.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Camille',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/da31231b-666d-4167-a02e-9e619c0dc22c.jpg?aki_policy=profile_small'},
   'author_id': 8054257,
   'can_be_edited': False,
   'comments': 'Je recommande vivement cet appartement. TrÃ¨s bien situÃ© dans Chamonix, un appartement fonctionnel et propre, avec une trÃ¨s belle vue sur le Mont-Blanc. Patricia et Thierry sont trÃ¨s accueillants, arrangeants et disponibles. Jâ€™y retournerai sans hÃ©sitation!',
   'created_at': '2021-04-03T11:33:57Z',
   'id': 744854651,
   'id_str': '744854651',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 4, 3, 11, 33, 57, tzinfo=tzutc())},
  {'author': {'first_name': 'Nicolas',
    'has_profile_pic': False,
    'id': 392379609,
    'picture_url': 'https://a0.muscache.com/defaults/user_pic-225x225.png?v=3',
    'smart_name': 'Nicolas',
    'thumbnail_url': 'https://a0.muscache.com/defaults/user_pic-50x50.png?v=3'},
   'author_id': 392379609,
   'can_be_edited': False,
   'comments': 'Un appartement bien agencÃ© trÃ¨s propre et proche du centre ville. Les propriÃ©taires sont Ã©galement rÃ©actifs et trÃ¨s sympathique. Je recommande vivement ',
   'created_at': '2021-03-20T12:59:02Z',
   'id': 740510018,
   'id_str': '740510018',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 3, 20, 12, 59, 2, tzinfo=tzutc())},
  {'author': {'first_name': 'HÃ©lÃ¨ne',
    'has_profile_pic': True,
    'id': 76814860,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/95109087-2760-4977-af7b-643eac2e69b4.jpg?aki_policy=profile_x_medium',
    'smart_name': 'HÃ©lÃ¨ne',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/95109087-2760-4977-af7b-643eac2e69b4.jpg?aki_policy=profile_small'},
   'author_id': 76814860,
   'can_be_edited': False,
   'comments': 'Logement correct. Il est idÃ©alement situÃ©. Rue piÃ©tonne avec tous commerces Ã  5 min. RÃ©sidence trÃ¨s calme. La vue du Mont Blanc et aiguille du midi depuis le balcon est magnifique.',
   'created_at': '2021-03-13T13:53:02Z',
   'id': 738497725,
   'id_str': '738497725',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 4,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 3, 13, 13, 53, 2, tzinfo=tzutc())},
  {'author': {'first_name': 'Sarah',
    'has_profile_pic': False,
    'id': 140066313,
    'picture_url': 'https://a0.muscache.com/defaults/user_pic-225x225.png?v=3',
    'smart_name': 'Sarah',
    'thumbnail_url': 'https://a0.muscache.com/defaults/user_pic-50x50.png?v=3'},
   'author_id': 140066313,
   'can_be_edited': False,
   'comments': 'Conforme Ã  la description \nAppartement et hÃ´tes agrÃ©ables, bel emplacement',
   'created_at': '2021-02-27T14:17:39Z',
   'id': 734709492,
   'id_str': '734709492',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 2, 27, 14, 17, 39, tzinfo=tzutc())},
  {'author': {'first_name': 'Anne',
    'has_profile_pic': True,
    'id': 102697326,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/a3cc14bc-4011-461d-b371-05ccef564024.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Anne',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/a3cc14bc-4011-461d-b371-05ccef564024.jpg?aki_policy=profile_small'},
   'author_id': 102697326,
   'can_be_edited': False,
   'comments': 'Lâ€™appartement de Patricia et Thierry nous a beaucoup plu ! Il est idÃ©alement situÃ© Ã  5min Ã  pied du centre ville et de la gare Chamonix Aiguille du midi. Il est trÃ¨s propre, la cuisine est bien Ã©quipÃ©e et lâ€™Ã©tage pour le coin nuit avec sdb est trÃ¨s apprÃ©ciÃ©. Et quelle vue sur le massif du Mont Blanc !! \nNous remercions Thierry pour sa rÃ©activitÃ©. \nNous reviendrons sans hÃ©siter en hiver comme en Ã©tÃ©!',
   'created_at': '2021-02-21T14:15:02Z',
   'id': 733162436,
   'id_str': '733162436',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 2, 21, 14, 15, 2, tzinfo=tzutc())},
  {'author': {'first_name': 'Philippe',
    'has_profile_pic': False,
    'id': 69221950,
    'picture_url': 'https://a0.muscache.com/defaults/user_pic-225x225.png?v=3',
    'smart_name': 'Philippe',
    'thumbnail_url': 'https://a0.muscache.com/defaults/user_pic-50x50.png?v=3'},
   'author_id': 69221950,
   'can_be_edited': False,
   'comments': 'Patricia trÃ¨s sympathique accueillante et disponible.  Appartement correspondant Ã  la description faite.  Neuf, trÃ¨s propre dÃ©coration de bon goÃ»t. Vue sur le Mont Blanc, avec un parking en sous-sol apprÃ©ciÃ©. Je le recommande.',
   'created_at': '2021-01-30T14:30:16Z',
   'id': 727631522,
   'id_str': '727631522',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 1, 30, 14, 30, 16, tzinfo=tzutc())},
  {'author': {'first_name': 'Julien',
    'has_profile_pic': True,
    'id': 52314839,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/144d0a70-1778-4835-9d7f-32205a319465.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Julien',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/144d0a70-1778-4835-9d7f-32205a319465.jpg?aki_policy=profile_small'},
   'author_id': 52314839,
   'can_be_edited': False,
   'comments': 'N hÃ©sitez pas une seule seconde vous serez trÃ¨s bien reÃ§u chez Patricia et Thierry.\nUn accueil vraiment trÃ¨s chaleureux.\nLe logement est trÃ¨s propre et extrÃªmement bien placÃ© !!! \nSi vous devez venir sur Chamonix c est l appartement parfait.',
   'created_at': '2021-01-23T12:25:36Z',
   'id': 726110604,
   'id_str': '726110604',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 1, 23, 12, 25, 36, tzinfo=tzutc())},
  {'author': {'first_name': 'Mohamed',
    'has_profile_pic': True,
    'id': 194410942,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/bffb8790-29d6-4bb9-bc36-2e6b76b1d48e.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Mohamed',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/bffb8790-29d6-4bb9-bc36-2e6b76b1d48e.jpg?aki_policy=profile_small'},
   'author_id': 194410942,
   'can_be_edited': False,
   'comments': "SituÃ© face Ã  ce que la nature peut vous offrir de plus beau (le Mont-blanc), cet appartement chaleureux m'a permis un dÃ©paysement total. Proche de toutes commoditÃ©s (transport, commerce...), mon vÃ©hicule a lui aussi, profitÃ© de l'abri du garage souterrain  pendant tout le sÃ©jour.  Concernant mon accueil, celui-ci  Ã©tait au top. Patricia et Thierry ont su m'accueillir chaleureusement et prendre le temps de tout m'expliquer. C'est un couple disponible avec une grande gentillesse.  L'appartement est confortable  et on se lasse jamais de cette vue en prenant son cafÃ© le matin. Encore merci !!!",
   'created_at': '2021-01-09T14:22:32Z',
   'id': 722964305,
   'id_str': '722964305',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 1, 9, 14, 22, 32, tzinfo=tzutc())},
  {'author': {'first_name': 'Amandine',
    'has_profile_pic': True,
    'id': 66366222,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/5fe7cb73-ffc5-4e27-ab9f-1892ad0bcc17.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Amandine',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/5fe7cb73-ffc5-4e27-ab9f-1892ad0bcc17.jpg?aki_policy=profile_small'},
   'author_id': 66366222,
   'can_be_edited': False,
   'comments': 'Super appartement conforme Ã  lâ€™annonce avec une superbe vue ! \nUn accueil chaleureux de Patricia et Thierry, bref un super sÃ©jour !',
   'created_at': '2021-01-02T13:09:00Z',
   'id': 720744152,
   'id_str': '720744152',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'fr',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2021, 1, 2, 13, 9, tzinfo=tzutc())},
  {'author': {'first_name': 'Ally',
    'has_profile_pic': True,
    'id': 11287096,
    'picture_url': 'https://a0.muscache.com/im/users/11287096/profile_pic/1442131015/original.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Ally',
    'thumbnail_url': 'https://a0.muscache.com/im/users/11287096/profile_pic/1442131015/original.jpg?aki_policy=profile_small'},
   'author_id': 11287096,
   'can_be_edited': False,
   'comments': "Excellent place to spend my first month in Chamonix; Patricia and Thierry were extremely helpful and responsive; the apartment is as described; the location is excellent; the view from the balcony is stunning; everything is clean and works properly; internet was fine for work video-conferences, etc; I couldn't have been happier with this choice :-)",
   'created_at': '2020-11-18T13:48:57Z',
   'id': 709710631,
   'id_str': '709710631',
   'listing_id': 36902451,
   'recipient_id': 251507728,
   'collection_tag': None,
   'listing': {'id': 36902451,
    'listing_id_str': '36902451',
    'name': 'Duplex spacieux et lumineux au centre de Chamonix'},
   'rating': 5,
   'recipient': {'first_name': 'Patricia &amp; Thierry',
    'has_profile_pic': True,
    'id': 251507728,
    'picture_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_x_medium',
    'smart_name': 'Patricia &amp; Thierry',
    'thumbnail_url': 'https://a0.muscache.com/im/pictures/user/2cfba405-b621-42b6-8d58-4bf53055f5e2.jpg?aki_policy=profile_small'},
   'response': '',
   'role': 'guest',
   'language': 'en',
   'user_flag': None,
   'created_at__dt': datetime.datetime(2020, 11, 18, 13, 48, 57, tzinfo=tzutc())}]}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Publishing-data-as-a-webservice">
<a class="anchor" href="#Publishing-data-as-a-webservice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publishing data as a webservice<a class="anchor-link" href="#Publishing-data-as-a-webservice"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Info</span><span class="p">(</span><span class="n">flr</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Info</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'success'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'version'</span><span class="p">:</span> <span class="s1">'0.1.0'</span><span class="p">,</span>
            <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'ready'</span>
        <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Hosting</span><span class="p">(</span><span class="n">flr</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">'__init__ for model "</span><span class="si">{0}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">'model_id'</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Statics</span><span class="o">.</span><span class="n">g_models</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">'model_id'</span><span class="p">]][</span><span class="s1">'model'</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reqparse</span> <span class="o">=</span> <span class="n">flr_r</span><span class="o">.</span><span class="n">RequestParser</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">input_features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reqparse</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">feature_name</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="s1">'json'</span><span class="p">,</span>
                <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s1">'"'</span><span class="o">+</span> <span class="n">feature</span><span class="o">.</span><span class="n">feature_name</span> <span class="o">+</span><span class="s1">'" is mandatory (</span><span class="si">{error_msg}</span><span class="s1">)'</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Hosting</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">error_details</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reqparse</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
            
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">input_features</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_name</span><span class="p">]</span>

            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="nb">input</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

            <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_details</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'success'</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
            <span class="s1">'error'</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span>
            <span class="s1">'error_details'</span><span class="p">:</span> <span class="n">error_details</span><span class="p">,</span>
            <span class="s1">'result'</span><span class="p">:</span> <span class="n">result</span>
        <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="braibaud/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/python/api/webservice/flask/2021/06/08/Exposing-API-data-via-Flask.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A collection of notebooks from my personal research projects.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/braibaud" title="braibaud"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/braibaud" title="braibaud"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
